# Мои заметки по обработке аудио

## Основные понятия цифрового звука

### Сэмплирование (Дискретизация)
- **Сэмплирование, выборка, дискретизация** - измерение значений непрерывного сигнала через равные промежутки времени
- **Сэмпл** - амплитуда в конкретный момент времени
- **Число сэмплов** - общее количество измерений в аудиофайле
- **Формула длительности**: `n_samp / част.дискр.`

### Частота дискретизации
- **Частота дискретизации** - сколько раз измерили за секунду [Гц]
- Высокое разрешение: 192 кГц
- Для обучения: 16 кГц (речь человека в пределах 8 кГц)
- У данных должна быть одинаковая частота дискретизации → **Передискретизация**

### Амплитуда и битовая глубина
- **Амплитуда** - громкость (давление звука) [Дб]
- **Битовая глубина** - насколько точно измерена амплитуда [Бит]
- Обычно 16 или 24 бит
- Аналогия: глубина цвета в изображениях

## Характеристики аудио

### Базовые параметры
- **Количество каналов**:
  - 1: моно
  - 2: стерео (левый/правый)
  - 3+: многоканальное (кино, игры)

### Уровни и качество
- **`peak_level`** - максимальная амплитуда
- **`rms_level`** - громкость
- **`clipping_ratio`** - доля сэмплов с амплитудой ≥ 0.999
- **Клиппинг** - когда амплитуда превышает максимум для цифровой системы

### Аналитические метрики
- **`zcr`** (zero crossing rate) - насколько мелко и часто колеблется звук вокруг тишины
- **Центроид и полоса** - "цвет" звука и его "чистота"

#### Аналогии:
- **Низкий центроид + узкая полоса** = группа невысоких людей одинакового роста
- **Высокий центроид + широкая полоса** = смесь очень высоких и очень низких людей
- Флейта против скрипки, определение тембра
- Широкий спектр = шум

### Спектральная полоса (Bandwidth)
- Показывает: насколько "размазан" спектр вокруг центроида

### Процентили
- **`p95`** - 95й процентиль - значение, которое превышают только 5% данных
- Пример: если `p95(duration) = 8.0`, значит 95% файлов короче 8 секунд

## Качество записи

### Качественная запись:
Peak < 0.9, Clipping ≈ 0.0, RMS 0.05-0.2

### Проблемная запись:
Peak > 0.95 + Clipping > 0.01 = искажения
RMS < 0.02 + Peak < 0.3 = слишком тихая
High ZCR + Wide bandwidth = шум


## Представления звука

### Waveform
- Сырое представление звука
- Чисто амплитуда и время, без полутонов, шепотов

### STFT (Short Time Fourier Transform)
- То же самое, но вместо амплитуды - частота

### Spectrogram dB
- Как физически выглядит звук с частотой и временем
- Математическое представление

## MEL и LOG преобразования

### MEL спектрограмма
- Наше ухо нелинейно воспринимает частоту
- **Линейная шкала (Герцы)**: 100 Гц → 200 Гц = 100 Гц разницы
- **Восприятие человека**: 100 Гц → 200 Гц = огромный скачок
- **Mel-шкала**: "растягивает" низкие частоты и "сжимает" высокие

### LOG спектрограмма
- Наше восприятие громкости нелинейно
- Чтобы звук стал вдвое громче, мощность должна увеличиться в 10 раз
- **Логарифмирование**: сжимает динамический диапазон

## Параметры MEL спектрограммы

### `n_mels` - количество полос Мела
| n_mels | Разрешение | Детализация | Использование |
|--------|------------|-------------|---------------|
| 16-40  | Низкое     | Грубая      | Быстрые эксперименты |
| 64-128 | Умеренное  | Хорошая     | Распознавание речи |
| 256+   | Высокое    | Детальная   | Анализ музыки |

### `htk` - способ расчета центров фильтров
- **`htk=False`** (по умолчанию) - формула Slaney
- **`htk=True`** - формула HTK
- Разница в распределении фильтров по диапазону

## Временные параметры

### `hop_length` - шаг окна
| hop_length | Временное разрешение | Кадров | Обнаружение событий |
|------------|---------------------|--------|---------------------|
| 64         | 4.0 мс              | ~313   | ✅✅✅ Отлично       |
| 256        | 16.0 мс             | ~78    | ✅✅ Хорошо          |
| 512        | 32.0 мс             | ~39    | ✅ Удовлетворительно |
| 1024       | 64.0 мс             | ~19    | ❌ Плохо            |

## Частотное разрешение

### `n_fft` - размер окна FFT
**Формула**: `частотное_разрешение = sampling_rate / n_fft`

Пример для SR=16000 Гц:
```python
n_fft = 512   → 16000/512  = 31.25 Гц/бин  # Низкое разрешение
n_fft = 2048  → 16000/2048 = 7.81 Гц/бин   # Среднее разрешение
n_fft = 4096  → 16000/4096 = 3.91 Гц/бин   # Высокое разрешение


Принцип неопределенности
Большой n_fft → хорошая частота, плохое время

Маленький n_fft → хорошее время, плохая частота

Пример:

python
n_fft = 4096 → окно = 4096/16000 = 0.256 сек  # Хорошая частота
n_fft = 512  → окно = 512/16000 = 0.032 сек   # Хорошее время